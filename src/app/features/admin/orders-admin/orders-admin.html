<div class="card p-3 shadow-sm">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Orders Management</h5>
    <button class="btn btn-sm btn-primary" (click)="refreshOrders()">
      ðŸ”„ Refresh
    </button>
  </div>
  
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Date</th>
        <th>Total</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (order of orders(); track order.order_id) {
        <tr>
          <td>{{ order.order_id }}</td>
          <td>{{ order.full_name }}</td>
          <td>{{ order.order_date | date: 'shortDate' }}</td>
          <td>â‚¹{{ order.totalAmount }}</td>
          <td>
            <select
              class="form-select form-select-sm"
              [ngModel]="order.status"
              (ngModelChange)="updateStatus(order.order_id, $event)"
            >
              <option value="Pending">Pending</option>
              <option value="Processing">Processing</option>
              <option value="Shipped">Shipped</option>
              <option value="Delivered">Delivered</option>
            </select>
          </td>
          <td>
            <button class="btn btn-info btn-sm" (click)="viewOrder(order.order_id)">
              View Items
            </button>
          </td>
        </tr>
      } @empty {
        <tr>
          <td colspan="6" class="text-center text-muted">No orders found</td>
        </tr>
      }
    </tbody>
  </table>
</div>

@if (selectedOrderId()) {
  <div
    class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex justify-content-center align-items-center"
    style="z-index: 1050"
  >
    <div class="card shadow-lg p-4" style="width: 600px; max-height: 80vh; overflow-y: auto">
      <div class="d-flex justify-content-between mb-3">
        <h5>Order #{{ selectedOrderId() }} Details</h5>
        <button class="btn btn-sm btn-outline-secondary" (click)="closeOverlay()">âœ•</button>
      </div>

      @if (isLoading()) {
        <div class="text-center">
          <div class="spinner-border text-primary"></div>
          <p class="mt-2">Loading...</p>
        </div>
      } @else {
        @if (selectedItems().length > 0) {
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              @for (item of selectedItems(); track item.id) {
                <tr>
                  <td>{{ item.productName }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>â‚¹{{ item.price_at_purchase }}</td>
                  <td>â‚¹{{ item.quantity * item.price_at_purchase }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <p class="text-center text-muted">No items found.</p>
        }
      }
    </div>
  </div>
}
